<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Form Permintaan Rekaman CCTV - PT Transportasi Jakarta</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f3f6f9; margin: 0; padding: 20px; }
    .container { max-width: 720px; margin: auto; background: #fff; padding: 25px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    h2 { text-align:center; color:#004b8d; }
    label { display:block; margin-top:15px; font-weight:bold; color:#333; }
    input, select, textarea { width:100%; padding:10px; margin-top:6px; border-radius:8px; border:1px solid #ccc; }
    button { margin-top:20px; width:100%; padding:12px; background:#004b8d; color:white; border:0; border-radius:10px; font-size:16px; cursor:pointer; }
    button:hover { background:#003f77; }
    #thumb { margin-top:10px; padding:10px; background:#eaeaea; border-radius:8px; text-align:center; }
    #prog { width:100%; background:#ddd; height:8px; border-radius:4px; margin-top:8px; }
    #bar { width:0%; background:#004b8d; height:8px; border-radius:4px; }
    #status { margin-top:15px; font-weight:bold; text-align:center; }
  </style>
</head>
<body>
<div class="container">
  <h2>Form Permintaan Rekaman CCTV</h2>

  <form id="cctvForm">
    <label>Email</label>
    <input type="email" id="email" required />

    <label>Nama Pemohon</label>
    <input type="text" id="namaPemohon" required />

    <label>NIK Pemohon</label>
    <input type="text" id="nikPemohon" required />

    <label>No Handphone</label>
    <input type="text" id="noHp" required />

    <label>Nama Atasan Pemohon</label>
    <input type="text" id="namaAtasan" required />

    <label>NIK Atasan Pemohon</label>
    <input type="text" id="nikAtasan" required />

    <label>Divisi</label>
    <input type="text" id="divisi" required />

    <label>Departemen</label>
    <input type="text" id="departemen" required />

    <label>Tanggal Pengajuan</label>
    <input type="date" id="tanggalPengajuan" required />

    <label>Perihal Kebutuhan</label>
    <textarea id="perihal" rows="3" required></textarea>

    <label>Tanggal Rekaman</label>
    <input type="date" id="tanggalRekaman" required />

    <label>Jam Awal</label>
    <input type="time" id="jamAwal" required />

    <label>Jam Akhir</label>
    <input type="time" id="jamAkhir" required />

    <label>Lokasi Kejadian</label>
    <select id="lokasi" required>
      <option value="">-- Pilih Lokasi --</option>
      <option value="Depo">Depo</option>
      <option value="Halte">Halte</option>
      <option value="Kantor Pusat">Kantor Pusat</option>
    </select>

    <label>Arah Kamera</label>
    <input type="text" id="arahKamera" required />

    <label>Lampiran (Opsional)</label>
    <input type="file" id="lampiran" accept="image/*" />
    <div id="thumb">Preview</div>
    <div id="prog"><div id="bar"></div></div>

    <button type="submit">Kirim Pengajuan</button>
    <div id="status"></div>
  </form>
</div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbyCu0J0y4kBg0YppUeNERKKjbB59p-TfqfddoDrNKwr_smTtteihsShWzxImAHjhWoqGQ/exec"; // <-- GANTI DENGAN WEB APP URL

  const form = document.getElementById("cctvForm");
  const statusEl = document.getElementById("status");
  const thumb = document.getElementById("thumb");
  const bar = document.getElementById("bar");
  let base64File = "";

  // Convert File â†’ Base64
  document.getElementById("lampiran").addEventListener("change", function(){
    const file = this.files[0];
    if(!file){ base64File = ""; return; }

    const reader = new FileReader();

    reader.onprogress = function(e){
      if(e.lengthComputable){
        bar.style.width = (e.loaded / e.total * 100) + "%";
      }
    };

    reader.onload = function(e){
      base64File = e.target.result;
      thumb.innerHTML = `<img src="${base64File}" style="max-width:200px;border-radius:8px;" />`;
    };

    reader.readAsDataURL(file);
  });

  // Submit Form
  form.addEventListener("submit", function(e){
    e.preventDefault();

    const data = {
      email: email.value,
      namaPemohon: namaPemohon.value,
      nikPemohon: nikPemohon.value,
      noHp: noHp.value,
      namaAtasan: namaAtasan.value,
      nikAtasan: nikAtasan.value,
      divisi: divisi.value,
      departemen: departemen.value,
      tanggalPengajuan: tanggalPengajuan.value,
      perihal: perihal.value,
      tanggalRekaman: tanggalRekaman.value,
      jamAwal: jamAwal.value,
      jamAkhir: jamAkhir.value,
      lokasi: lokasi.value,
      arahKamera: arahKamera.value,
      lampiran: base64File
    };

    statusEl.innerHTML = "Mengirim...";
    statusEl.style.color = "black";

    fetch(scriptURL, {
      method: "POST",
      mode: "no-cors",             // WAJIB UNTUK GITHUB PAGES
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(data)
    })
    .then(() => {
      statusEl.innerHTML = "Pengajuan berhasil dikirim!";
      statusEl.style.color = "green";
      form.reset();
      thumb.innerHTML = "Preview";
      bar.style.width = "0%";
    })
    .catch(() => {
      statusEl.innerHTML = "Gagal mengirim pengajuan.";
      statusEl.style.color = "red";
    });
  });
</script>

</body>
</html>
